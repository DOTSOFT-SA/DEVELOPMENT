# 'Create ERP Development Database Tables' App
### Δημιουργία Πινάκων 'Development' στη Βάση Δεδομένων του Συστήματος ERP

## Περιγραφή

Η **YOU.GR**, ως συνεργάτης του πρότζεκτ, παρείχε δεδομένα σε μορφή <u>τριών</u> αρχείων `.CSV` (**order_item.csv, product_sku.csv, competition.csv**) που θα χρησιμοποιηθούν για τις προβλέψεις του αλγορίθμου. Σκοπός του συγκεκριμένου app είναι η ενοποίηση αυτών των τριών αρχείων σε έναν ενιαίο πίνακα στη βάση δεδομένων του ERP (`sku_order_development`), εξασφαλίζοντας την ομαλή υλοποίηση του πρότζεκτ.

Επιπλέον, για την υλοποίηση του πρότζεκτ, είναι απαραίτητο η ERP βάση του πελάτη να περιλαμβάνει ακόμα <u>τέσσερις</u> πίνακες, τα δεδομένα των οποίων θα χρησιμοποιηθούν επίσης ως input για τους Machine Learning αλγορίθμους που υλοποιούν προβλέψεις ζήτησης, αποθεμάτων και routing (`inventory_params_development`, `vehicle_development`, `location_development` και `route_development`).

Συνολικά, το app στοχεύει στη δημιουργία των παρακάτω **<u>πέντε</u> πινάκων** στη βάση του Dolibarr ERP:

A. `sku_order_development`

B. `inventory_params_development`

C.	`vehicle_development`, `location_development` και `route_development`

Για περισσότερες πληροφορίες, δείτε το **ERD σχεδιάγραμμα [εδώ](https://drive.google.com/file/d/1fbsOSyjQy3NkR7fn94fl3pe0FAehOjnH/view?usp=sharing)**

---

## Πώς να Τρέξετε τo App Τοπικά

1.Δημιουργήστε ένα νέο (κενό) πρότζεκτ με το αγαπημένο σας IDE (π.χ., PyCharm)

2.Από το repository, κλωνοποιήστε/κατεβάστε τον φάκελο `create-erp-development-db-tables-app` και μετακινήστε τα αρχεία του στο νέο πρότζεκτ

* To αρχείο `.env` πρέπει να τοποθετηθεί στον root φάκελο του πρότζεκτ. Αυτό το αρχείο πρέπει να σας **δοθεί από τον υπεύθυνο του έργου** (βασιστείτε στο αρχείο `.env.sample`)
* Τοποθετήστε τα τρία `.CSV` αρχεία (`order_item.csv`, `product_sku.csv`, `competition.csv`) στον `data` φάκελο. Αυτά το τρία αρχεία πρέπει **να σας δοθούν επίσης από τον υπεύθυνο του έργου**.

3.Δημιουργήστε έναν `venv` φάκελο για το πρότζεκτ (δείτε πως [εδώ](https://stackoverflow.com/a/59895890))

4.Εκτελέστε την εντολή `pip install -r requirements.txt` για να εγκαταστήσετε τα απαραίτητα πακέτα/βιβλιοθήκες

5.Τρέξτε το αρχείο `main.py` στο terminal με την εντολή: `python main.py`

---
## Περιγραφή Λειτουργειών

### Λειτουργία 1 - `services/merge_csv_sku.py` & `services/create_sku_order_development_db_table.py`

1.<u>Φόρτωση των αρχείων CSV</u>: <br>
Τα τρία αρχεία (`order_item.csv`, `product_sku.csv`, `competition.csv`) φορτώνονται από τον φάκελο `data` και μετατρέπονται σε DataFrames (`order_item_df`, `product_sku_df`, `competition_df`)

2.<u>Φίλτραρισμα στο `competition_df`</u>:

* Για κάθε προϊόν στο `order_item_df`, αναζητούνται οι τιμές από το `competition_df` που έχουν ημερομηνία (`price_date`) μικρότερη ή ίση (**<=**) της ημερομηνίας παραγγελίας (`order_date`). Εάν δεν υπάρχει προηγούμενη ή ίση ημερομηνία, επιλέγεται η κοντινότερη επόμενη ημερομηνία.
* Ο σκοπός αυτής της φίλτρανσης είναι να βρεθεί η πιο σχετική (πιο κοντινή χρονικά) τιμή ανταγωνιστή για κάθε παραγγελία προϊόντος, εξασφαλίζοντας ακρίβεια στη συσχέτιση δεδομένων.

3.<u>Ενοποίηση Δεδομένων</u>: <br>
Μετά τη φίλτρανση, τα records από τα `order_item.df` και `competition_df_filtered` ενώνονται σε ένα αρχείο με γνώμονα τις στήλες `sku_number` και `order_date`

4.<u>Τελική Ενοποίηση</u>: μετά την πρώτη ένωση, τα δεδομένα συνδυάζονται περαιτέρω και με το DataFrame `product_sku_df`

5.<u>Αποθήκευση στη Βάση Δεδομένων - `create_sku_order_development_db_table.py`</u>:

* Μετά από περεταίρω επεξεργασία, τα συγχωνευμένα δεδομένα αποθηκεύονται στον πίνακα `sku_order_development` της βάσης δεδομένων του ERP-Dolibarr
* Εάν η εγγραφή στη βάση αποτύχει, τα συγχωνευμένα δεδομένα αποθηκεύονται σε ένα single `.CSV` αρχείο (`sku_order_development.csv`) ως local backup

---

### Λειτουργία 2 - `services/create_inventory_params_development_db_table.py`
Το script αυτό δημιουργεί στη ERP Dolibarr βάση τον πίνακα **`inventory_params_development`**, χρησιμοποιώντας και δεδομένα από τον πίνακα **`sku_order_development`**.

**Δημιουργία Συνθετικών Δεδομένων**: Παράγει παραμέτρους αποθέματος για κάθε προϊόν (`sku_number`):

- `sku_number`: Ο αριθμός του προϊόντος (SKU), προέρχεται από τον πίνακα **`sku_order_development`**.
- `stock_level`: Η διαθέσιμη ποσότητα αποθέματος για το συγκεκριμένο προϊόν (SKU).
- `time_period_t`: Σταθερή χρονική περίοδος (π.χ. 1-2 εβδομάδες ή 1 μονάδα χρόνου).
- `fixed_order_cost_k`: Σταθερό κόστος ανά παραγγελία (π.χ. 50 € για την παραγγελία).
- `penalty_cost_p`: Κόστος ποινής ανά τεμάχιο ακάλυπτης ζήτησης (π.χ. 10 € ανά τεμάχιο).
- `holding_cost_rate_i`: Ποσοστό κόστους αποθήκευσης ανά τεμάχιο αποθέματος (π.χ. 1.5%).
- `unit_cost_c`: Κόστος ανά τεμάχιο αποθέματος (π.χ. 25 € ανά τεμάχιο).
- `truckload_capacity_ftl`: Χωρητικότητα φορτηγού (π.χ. 40 τεμάχια ανά φορτηγό).
- `transportation_cost_tr`: Μεταφορικό κόστος (π.χ. 300 € ανά φορτηγό).

---

## Λειτουργία 3 - `services/create_routing_development_db_tables.py`
Το script αυτό δημιουργεί τους πίνακες **`vehicle_development`**, **`location_development`**, και **`route_development`**. Σε περίπτωση αποτυχίας της διαδικασίας εγγραφής στη βάση δεδομένων, τα δεδομένα κάθε πίνακα αποθηκεύονται σε αντίστοιχο αρχείο `.CSV` ως τοπικό αντίγραφο ασφαλείας (backup). Τα βασικά σημεία λειτουργίας είναι τα εξής:

**Δημιουργία Συνθετικών Δεδομένων**:

### **1. `vehicle_development`** - Παράγει δεδομένα για οχήματα, όπως:
- `vehicle_id`: Μοναδικό ID για κάθε όχημα
- `capacity`: Χωρητικότητα φορτίου
- `cost_per_trip`: Κόστος ανά διαδρομή, συσχετισμένο με τη χωρητικότητα

### **2. `location_development`** - Παράγει δεδομένα για τοποθεσίες, όπως:
- `location_id`: Μοναδικό ID για κάθε τοποθεσία
- `location_name`: Μοναδικό όνομα για κάθε τοποθεσία
- `demand`: Ζήτηση (0 για το depot)
- `is_depot`: Boolean που δηλώνει αν η τοποθεσία είναι το σημείο εκκίνησης και τερματισμού

### **3. `route_development`** - Παράγει δεδομένα διαδρομών μεταξύ τοποθεσιών, όπως:
- `route_id`: Μοναδικό ID για κάθε διαδρομή
- `distance`: Απόσταση
- `traffic_factor`: Παράγοντας κίνησης, συσχετισμένος με την απόσταση
- `source_location_id` και `destination_location_id`: Οι τοποθεσίες προέλευσης και προορισμού
- <u>Σημείωση</u>: `source_location_id` και `destination_location_id` ως `FOREIGN KEYS` που συσχετίζονται με τη στήλη `location_id` του πίνακα **`location_development`**.
